<!DOCTYPE html> <!-- Declares the document type as HTML5, which ensures the page is rendered as HTML5 -->
<html> <!-- Start of the HTML document -->
<head> <!-- Head section where the title and styles are defined -->
    <title>Invoices</title> <!-- Page title displayed on the browser tab -->

    <style>
        /* Internal CSS to style the page */
        body { 
            font-family: Arial; /* Sets the font for the page to Arial */
            background: #f4f4f4; /* Light grey background color for the body */
            padding: 20px; /* Adds padding around the body content */
        }

        table { 
            border-collapse: collapse; /* Ensures table borders are collapsed into a single line */
            width: 100%; /* Sets the table width to fill the available space */
            background: #fff; /* White background color for the table */
        }

        th, td { 
            border: 1px solid #ccc; /* Adds a light grey border to table headers and data cells */
            padding: 8px; /* Adds padding inside the table cells */
            text-align: left; /* Aligns the text in table cells to the left */
        }

        th { 
            background: #eee; /* Sets the background color of table headers to light grey */
        }

        input { 
            padding: 5px; /* Adds padding inside input fields */
            margin: 5px; /* Adds margin around input fields */
        }

        button { 
            padding: 5px 10px; /* Adds padding to the submit button */
        }

        .logout { 
            float: right; /* Positions the logout button on the right side of the page */
        }
    </style>
</head>
<body> <!-- Start of the body content -->

    <h1>Invoice</h1> <!-- Main title of the page -->
    
    <a href="/logout" class="logout">Logout</a> <!-- Logout link, positioned on the right -->
    
    <h2>Welcome, {{ session.username }}</h2> <!-- Displays a welcome message with the username stored in the session -->
 
    <h3>Add New Invoice</h3> <!-- Subheading for adding a new invoice -->

    {% if error %}   <!-- This part displays the error message (if any) -->
        <p style="color: red; margin-bottom: 10px;">{{ error }}</p>
    {% endif %}

    <form method="POST"> <!-- Form to submit a new invoice -->
        <input name="customer_name" placeholder="Customer Name" required> <!-- Input for customer name -->
        <input name="customer_address" placeholder="Customer Address" required> <!-- Input for customer address -->
        <input name="date" placeholder="DD/MM/YYYY" required> <!-- Input for date, with a date format placeholder -->
        <input name="invoice_no" placeholder="Invoice No" required> <!-- Input for invoice number -->
        <input name="description" placeholder="Description" required> <!-- Input for description of the invoice -->
        <input name="invoice_total" placeholder="Total" required> <!-- Input for the total amount of the invoice -->
        <button type="submit">Add Invoice</button> <!-- Submit button to add the new invoice -->
    </form>
 
    <h3>Invoices</h3> <!-- Subheading for the list of invoices -->
    
    <!-- Table to display all invoices -->
    <table>
        <tr>
            <th>Name</th> <!-- Column header for customer name -->
            <th>Invoice No</th> <!-- Column header for invoice number -->
            <th>Total</th> <!-- Column header for invoice total -->
            <th>Status</th> <!-- Column header for the invoice status -->
            <th>Actions</th> <!-- Column header for actions like edit and delete -->
        </tr>

        <!-- Loop through each invoice and display it in the table -->
        {% for invoice in invoices %} 
        <tr>
            <td>{{ invoice[2] }}</td> <!-- Customer name (index 2) -->
            <td>{{ invoice[5] }}</td> <!-- Invoice number (index 5) -->
            <td>Â£{{ "%.2f"|format(invoice[7]) }}</td> <!-- Invoice total formatted to 2 decimal places (index 7) -->
            <td>
                <!-- Displays the status of the invoice if it exists; otherwise, it shows "Unpaid" -->
                {% if invoice[8] %}
                    {{ invoice[8] }} 
                {% else %}
                    Unpaid
                {% endif %}
            </td>
            <td>
                <!-- Edit and delete actions for each invoice -->
                <a href="/edit/{{ invoice[0] }}">Edit</a> | <!-- Link to the edit page for this invoice (using invoice ID) -->
                <a href="/delete/{{ invoice[0] }}">Delete</a> <!-- Link to delete this invoice (using invoice ID) -->
            </td>
        </tr>
        {% endfor %}
    </table>

</body>
</html>
